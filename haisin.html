<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets API è¡¨ç¤º</title>
    <style>
        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ */
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            max-height: 80vh; /* ç”»é¢ã®80%ã®é«˜ã•ã§åˆ¶é™ */
            border: 1px solid #ddd;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse; /* ç½«ç·šã‚’ç¢ºå®Ÿã«é©ç”¨ */
            font-family: Arial, sans-serif;
            empty-cells: show; /* ç©ºã‚»ãƒ«ã®ç½«ç·šã‚’è¡¨ç¤º */
        }

        html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            white-space: nowrap;
            font-size: 16px;
            min-height: 20px; /* ç©ºã‚»ãƒ«ã§ã‚‚é«˜ã•ã‚’ç¢ºä¿ */
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®å›ºå®š */
        thead {
            position: sticky;
            top: 0;
            background-color: #4CAF50;
            color: white;
            z-index: 2;
        }

        thead tr {
            cursor: pointer; /* ã‚½ãƒ¼ãƒˆå¯èƒ½ */
        }

        /* ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã®åˆ—ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        th.sorted {
            background-color: #ffcc80 !important;
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .table-container::-webkit-scrollbar {
            height: 8px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        /* å¥‡æ•°è¡Œã®èƒŒæ™¯è‰² */
        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* ãƒ›ãƒãƒ¼æ™‚ã®è‰² */
        tbody tr:hover {
            background-color: #f1f1f1;
        }

        /* ã‚½ãƒ¼ãƒˆç”¨ã®ã‚¢ã‚¤ã‚³ãƒ³ */
        .sort-icon {
            margin-left: 8px;
            font-size: 12px;
        }

        /* ã‚¹ãƒãƒ›å¯¾å¿œ */
        @media (max-width: 600px) {
            th, td {
                padding: 10px;
                font-size: 14px;
            }
        }

        /* æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #searchInput {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .highlight {
            background-color: yellow;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h2>ãŸãã‚‰ã¼é…ä¿¡ãƒ—ãƒ¬ã‚¤ã‚²ãƒ¼ãƒ ãƒªã‚¹ãƒˆ</h2>

    <p>
        <a href="https://www.youtube.com/playlist?list=PLKffMDfIWsbbXZXSjrkkiFI1pk-sGPN4F" target="_blank">
            ğŸ“º å†ç”Ÿãƒªã‚¹ãƒˆã‚’è¦‹ã‚‹
        </a>
    </p>
    
    <!-- æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <input type="text" id="searchInput" placeholder="æ¤œç´¢..." onkeyup="filterTable()">
    <p id="resultCount">ğŸ” æ¤œç´¢çµæœ: 0 ä»¶</p>

    <div class="table-container">
        <table id="sheetTable">
            <thead>
                <tr id="tableHeader"></tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        const sheetID = "1Vn-LSQZHBdbfnjMfHDGD4Lqr30egE46MEQFrptIZRFc"; // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID
        const apiKey = "AIzaSyDiQaxgz_ixPu6lzQXwdOPzgaKvflUfcio"; // Google APIã‚­ãƒ¼
        const range = "ã‚·ãƒ¼ãƒˆ2!A1:G"; // å–å¾—ç¯„å›²

        const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/${range}?key=${apiKey}`;

        let tableData = []; // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨
        let sortOrder = {}; // ã‚½ãƒ¼ãƒˆçŠ¶æ…‹
        const unsortableColumns = [6]; // ã‚½ãƒ¼ãƒˆä¸å¯ã®åˆ—ï¼ˆ6ç•ªç›®ã®IDåˆ—ã‚’ã‚½ãƒ¼ãƒˆç¦æ­¢ï¼‰

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const rows = data.values;
                if (!rows || rows.length === 0) {
                    console.log("ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
                    return;
                }

                tableData = rows.slice(1); // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
                createTable(rows);
            })
            .catch(error => console.error("ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:", error));

        function createTable(rows) {
            const tableHeader = document.getElementById("tableHeader");
            const tableBody = document.getElementById("tableBody");

            // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œæˆ
            rows[0].forEach((header, index) => {
                const th = document.createElement("th");
                th.textContent = header;

                // ã‚½ãƒ¼ãƒˆç¦æ­¢ã®åˆ—ã¯ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä»˜ã‘ãªã„
                if (!unsortableColumns.includes(index)) {
                    th.onclick = () => sortTable(index);
                    th.innerHTML += `<span class="sort-icon">â–²â–¼</span>`;
                }

                tableHeader.appendChild(th);
            });

            renderTable(tableData);
        }

    function renderTable(data) {
        const tableBody = document.getElementById("tableBody");
        tableBody.innerHTML = ""; // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ

        data.forEach(row => {
            const tr = document.createElement("tr");
            for (let i = 0; i < data[0].length; i++) {
                const td = document.createElement("td");
                td.innerHTML = row[i] !== undefined && row[i] !== "" ? row[i] : "&nbsp;"; // ç©ºã‚»ãƒ«å¯¾ç­–
                tr.appendChild(td);
            }
            tableBody.appendChild(tr);
        });
    }

        function sortTable(columnIndex) {
            // ã‚½ãƒ¼ãƒˆä¸å¯ã®åˆ—ãªã‚‰å‡¦ç†ã—ãªã„
            if (unsortableColumns.includes(columnIndex)) return;

            // æ˜‡é †ãƒ»é™é †ã‚’åˆ‡ã‚Šæ›¿ãˆ
            const order = sortOrder[columnIndex] === "asc" ? "desc" : "asc";
            sortOrder[columnIndex] = order;

            tableData.sort((a, b) => {
                let valA = a[columnIndex] || "";
                let valB = b[columnIndex] || "";

                if (!isNaN(valA) && !isNaN(valB)) {
                    return order === "asc" ? valA - valB : valB - valA;
                }

                return order === "asc"
                    ? valA.localeCompare(valB, 'ja')
                    : valB.localeCompare(valA, 'ja');
            });

            renderTable(tableData);
            updateSortIcons(columnIndex, order);
        }

        function updateSortIcons(columnIndex, order) {
            document.querySelectorAll("th").forEach((th, index) => {
                th.classList.toggle("sorted", index === columnIndex);
                const icon = th.querySelector(".sort-icon");
                if (icon) {
                    icon.innerHTML = index === columnIndex
                        ? (order === "asc" ? "â–²" : "â–¼")
                        : "â–²â–¼";
                }
            });
        }

        function filterTable() {
            const searchValue = document.getElementById("searchInput").value.toLowerCase();
            const filteredData = tableData.filter(row => row.some(cell => (cell || "").toLowerCase().includes(searchValue)));
            renderTable(filteredData);
        }

    document.getElementById("searchInput").addEventListener("input", function () {
        const searchText = this.value.toLowerCase();
        const rows = document.querySelectorAll("#tableBody tr");
        let matchCount = 0;
    
        rows.forEach(row => {
            let rowMatch = false;
            const cells = row.getElementsByTagName("td");
    
            for (let cell of cells) {
                const text = cell.textContent;
                const lowerText = text.toLowerCase();
                
                if (searchText && lowerText.includes(searchText)) {
                    rowMatch = true;
                    // ğŸ”¹ ä¸€è‡´ã™ã‚‹éƒ¨åˆ†ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    const regex = new RegExp(`(${searchText})`, "gi");
                    cell.innerHTML = text.replace(regex, '<span class="highlight">$1</span>');
                } else {
                    cell.innerHTML = text; // ğŸ”¹ ã‚¯ãƒªã‚¢ï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ¶ˆã™ï¼‰
                }
            }
    
            // ğŸ”¹ ä¸€è‡´ã™ã‚‹è¡Œã ã‘è¡¨ç¤º
            if (rowMatch) {
                row.style.display = "";
                matchCount++;
            } else {
                row.style.display = "none";
            }
        });

    // ğŸ”¹ æ¤œç´¢çµæœã®ä»¶æ•°ã‚’æ›´æ–°
    document.getElementById("resultCount").textContent = `ğŸ” æ¤œç´¢çµæœ: ${matchCount} ä»¶`;
});
        
    </script>

</body>
</html>
